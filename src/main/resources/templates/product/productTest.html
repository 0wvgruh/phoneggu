<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>상품 상세</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2 th:text="${product.prName}">상품명</h2>
    <div class="row">
        <div class="col-md-6">
            <img th:src="${product.productImgDtoList[0].imgUrl}" class="img-fluid" th:alt="${product.prName}">
        </div>
        <div class="col-md-6">
            <div>
                <span th:if="${product.productSellStatus == T(com.jsbs.casemall.constant.ProductSellStatus).SELL}"
                      class="badge badge-primary">판매중</span>
                <span th:unless="${product.productSellStatus == T(com.jsbs.casemall.constant.ProductSellStatus).SELL}"
                      class="badge badge-danger">품절</span>
            </div>
            <div class="h4 text-danger mt-3">
                <span th:text="${product.prPrice}"></span>원
            </div>
            <div class="mt-3">
                <label for="quantity">수량</label>
                <input type="number" id="quantity" name="quantity" class="form-control" value="1" min="1" max="10">
            </div>
            <div class="mt-4">
                <a id="addToCartBtn" class="btn btn-light border border-primary">장바구니 담기</a>
                <a id="orderNowBtn" class="btn btn-primary">주문하기</a>
            </div>
        </div>
    </div>
    <div class="jumbotron jumbotron-fluid mt-5">
        <div class="container">
            <h4 class="display-5">상품 상세 설명</h4>
            <hr class="my-4">
            <p class="lead" th:text="${product.prDetail}"></p>
        </div>
    </div>
    <div th:each="productImg : ${product.productImgDtoList}" class="text-center">
        <img th:if="${not #strings.isEmpty(productImg.imgUrl)}" th:src="${productImg.imgUrl}"
             class="rounded mb-3" width="800">
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    $(document).ready(function() {
        $('#addToCartBtn').on('click', function() {
            var productId = [[${product.id}]];
            var quantity = $('#quantity').val();

            $.ajax({
                url: '/cart/add',
                type: 'POST',
                data: {
                    prId: productId,
                    count: quantity
                },
                success: function(response) {
                    alert('장바구니에 추가되었습니다.');
                },
                error: function(xhr, status, error) {
                    alert('장바구니 추가에 실패했습니다.');
                }
            });
        });

        $('#orderNowBtn').on('click', function() {
            var productId = [[${product.id}]];
            var quantity = $('#quantity').val();
            window.location.href = '/pay?prId=' + productId + '&count=' + quantity;
        });
    });
</script>
</body>
</html>
